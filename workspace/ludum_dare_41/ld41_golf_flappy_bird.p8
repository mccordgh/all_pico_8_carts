pico-8 cartridge // http://www.pico-8.com
version 15
__lua__
function _init()
    init_game()
    init_ball()
    init_player()
end

function init_game()
    gravity = 0.15
    wind = 0.15
    friction = 0.05
    meter_speed = .1
    
    power = 0
    max_power = 18
    draw_power = true
    power_meter_speed = max_power * meter_speed
    
    lift = 0
    max_lift = 6
    draw_lift = true
    lift_meter_speed = max_lift * meter_speed

    landed = false
    hitting_ball = false

    state = hitting_state
end


function _update()
    state()
end

function _draw()
    cls()
    set_camera()

    map(0, 0, 0, 0, 128, 16)

    spr(3, ball.x, ball.y)

        draw_meter_box()

    if (draw_power) then
        local power_percent = (power / max_power) * 100
        if (power_percent > 100) then
            power_percent = 100
        end
        print ("P O W E R ", 29, 58, 14)
        rectfill(20, 50, 20 + (power_percent / 2), 56, 14)
    end

    if (draw_lift) then
        local lift_percent = (lift / max_lift) * 100
        if (lift_percent > 100) then
            lift_percent = 100
        end
        print ("L", 19, 12, 9)
        print ("I", 19, 20, 9)
        print ("F", 19, 28, 9)
        print ("T", 19, 36, 9)
        rectfill(10, 56 - (lift_percent / 2), 16, 56, 9)
    end 

    debug_info()
end

function draw_meter_box()
    rectfill(8, 4, 72, 64, 0)
    --print ("PRESS Z TO STOP", 39, 56, 15)    
end

function init_ball()
    ball = {}
    ball.x = 16
    ball.x_speed = 0
    ball.y = 108
    ball.y_speed = 0
    ball.width = 8
    ball.sprite = 3
end

function init_player()
    player = {}
    player.power = -1
    player.lift = -1
end

function hitting_state()
if (not hitting_ball) then
        not_hitting()
    else
        hitting()
    end
end

function landed_state()

end

function power_meter()
    power += power_meter_speed

    if (btnp(4)) then
        if (power > max_power) then
            power = max_power
        end
        player.power = power
    end

    if (power >= max_power + (max_power * .05)) then
        power = 0
    end
end

function lift_meter()
    lift += lift_meter_speed

    if (btnp(4)) then
        if (lift > max_lift) then
            lift = max_lift
        end
        player.lift = lift
    end

    if (lift >= max_lift + (max_lift * .05)) then
        lift = 0
    end
end

function not_hitting()
    if (player.power == -1) then
        power_meter()
    else if (player.lift == -1) then
        lift_meter()
    else
        hitting_ball = true

        ball.x_speed = player.power
        ball.y_speed = player.lift
    end
    end
end

function hitting()
    ball_collision()
    apply_ball_force()
    apply_physics()
end

function ball_collision()
    if (ball.x < 8 or ball.x + ball.width > 1016) then
        ball.x_speed = 0
    end

    if (ball.y > 108) then
        ball.y_speed = 0
        ball.y = 108
    end

    if (ball.y == 108) then
        if (ball.x_speed == 0) then
            hitting_ball = false
            state = landed_state
            ball.sprite = 4
        else
            ball.x_speed -= friction
        end
    end
end

function apply_ball_force()
    ball.x += ball.x_speed
    ball.y -= ball.y_speed
end

function apply_physics()
    ball.x_speed -= wind
    ball.y_speed -= gravity

    if (ball.x_speed < 0) then
        ball.x_speed = 0
    end

    if (ball.y > 108) then
        ball.y_speed = 0
        ball.y = 108
    end
end

function debug_info()
    --print("camera x: " .. cam_x, cam_x + 10, 10, 15)
    --print("ball x: " .. ball.x .. ", y: " .. ball.y, cam_x + 10, 20, 15)
    --print("ball speed x: " .. ball.x_speed .. ", y: " .. ball.y_speed, cam_x + 10, 30, 15)
    --print("POW: " .. power, cam_x + 10, 10, 15)
    --print("LIFT: " .. lift, cam_x + 10, 20, 15)
end

function set_camera()
    if (ball.x - 64 < 0) then
        cam_x = 0
    else if (ball.x + ball.width > 966) then
        cam_x = 894
    else
        cam_x = ball.x - 64
    end
    end

    camera(cam_x, 0)
end
__gfx__
00000000ccccccccbbbbbbbb00000000000000003333333333333333333b33333333333300000000000000000000000000000000000000000000000000000000
00000000ccccccccbbbbbbbb000ff000000000003333333333333333333333333333333300000000000000000000000000000000000000000000000000000000
00700700ccccccccbbbbbbbb00ffff00000870003333333b33333333333333333333333300000000000000000000000000000000000000000000000000000000
00077000ccccccccbbbbbbbb0fff77f000088a003b3333b3b333333333333b333b33333300000000000000000000000000000000000000000000000000000000
00077000ccccccccbbbbbbbb0ffff7f00802808033b33333333333b33b3333b33333333b00000000000000000000000000000000000000000000000000000000
00700700ccccccccbbbbbbbbfffffffff082880f3333333333333333b33333333333333300000000000000000000000000000000000000000000000000000000
00000000ccccccccbbbbbbbb0ffffff00ff88ff03333333333333333333333333333333300000000000000000000000000000000000000000000000000000000
00000000ccccccccbbbbbbbb00ffff0000ffff003333b33333333333333333333333333300000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000003333333333b3b333000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000033b33333333b3333000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000003333333333333333000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000003333333333333333000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000002222222222222222000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000424444f444444444000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000004f44244424442442000000000000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000000000000044244424442f4424000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0201010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010102
0201010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010102
0201010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010102020201010101010101010101010101010101010101010101010101020202010101010101010101010101010101010101010101010101010102
0201010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101020201010202010101010101010101010101010101010101010101010202010101020201010101010101010101010101010101010101010101010102
0201010101010101010101010101010101010101010101010101010101010101010101010101020202020101010101010101010101010101010101010101010101010102020101010101020201010101010101010101010101010101010101020201010101010102020101010101010101010101010101010101010101010102
0201010101010102020202020202020101010101010101010101010101010101010101010102020101010202020101010101010101010101010101010101010101010201010101010101010102020101010101010101010101010101010201010101010101010101010202010101010101010101010101010101010101010102
0201010101010202010101010101010202010101010101010101010101010101010101020202010101010101010202010101010101010101010101010101010102020101010101010101010101020201010101010101010101010101010201010101010101010101010101020101010101010101010101010101010101020202
0201010101020101010101010101010101020202020101010101010101010101020202010101010101010101010102020201010101010101010101010101020201010101010101010101010101010202010101010101010101010101020101010101010101010101010101010201010101010101010101010101010102020102
0201010102010101010101010101010101010101020202020201010102020202020101010101010101010101010101010202020101010101010101010202010101010101010101010101010101010101020201010101010101010202010101010101010101010101010101010102010101010101010101010101020201010102
0201010201010101010101010101010101010101010101010101020201010101010101010101010101010101010101010101010202020101010102020201010101010101010101010101010101010101010202020201010101010201010101010101010101010101010101010101020101010101010101010202010101010102
0201020101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010202020201010101010101010101010101010101010101010101010101010202020202020101010101010101010101010101010101010101010202010101010102020101010101010102
0201010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010102020202020201010101010101010102
0201010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010101010102
0207080708070807080708070807080708070807080708070807070807080708070807080708070807080708070807080708070807080708070807070807080708070807080708070807080708070708070807080708070807080708070807080708070807080708070708070807080707080708070807080707080708070807
0605060506050606050605060506050605060506050605060506060506050605060506050605060506050605060605060506050605060506050605060506050605060506050605060506050605060506050605060506050606050605060506050605060506050605060506050605060506050506050605060506050605060506
1615161516151616151615161516151615161516151615161516161516151615161516151615161516151615161615161516151615161516151615161516151615161516151615161516151615161516151615161516151616151615161516151615161516151615161516151615161516151516151615161516151615161516
0202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
